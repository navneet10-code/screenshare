!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.iframeScreenshare=r()}(this,function(){"use strict";var e=!1;return{initializeScreenShare:function(r){window.chrome&&window.chrome.webstore&&!e&&(e=!0,window.addEventListener("message",function e(n){if(n&&n.data&&"getScreen"===n.data.type){var t=window.sessionStorage.getScreenMediaJSExtensionId;if(!t)try{var i=r.split("/").pop();window.open(r,"_webstore"),setTimeout(function(){if(window.sessionStorage.getScreenMediaJSExtensionId=i,n.data.installOnly)return n.source.postMessage(n.data,"*");e(n)},3500)}catch(e){return n.source.postMessage({err:e},"*")}if(n.data.installOnly)return n.source.postMessage(n.data,"*");window.chrome.runtime.sendMessage(t,n.data,function(e){n.source.postMessage(e,"*")})}}))},requestScreenShare:function(e,r){if(!window.navigator||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){if(!Promise)throw new Error("requestScreenShare called in unsupported browser");return Promise.reject(new Error("Unsupported"))}if(window.chrome)return new Promise(function(n,t){window.addEventListener("message",function r(i){if(!i||"process-tick"!==i.data){if(window===window.parent){if(i&&i.data&&("getScreen"===i.data.type||"getScreenPending"===i.data.type))return;if(!i.data)return}if(window.removeEventListener("message",r),!i||!i.data.sourceId)return i.data.err?t(i.data.err):i.data.installOnly?n(i.data):t(new Error("User Cancellation"));var a=e&&e.chrome||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15,chromeMediaSourceId:i.data.sourceId}}};window.navigator.mediaDevices.getUserMedia(a).then(n,t)}}),window.parent.postMessage({type:"getScreen",installOnly:r,id:1,url:window.location.origin},"*")});if(r)return Promise.resolve();var n=e&&e.firefox||{audio:!1,video:{mediaSource:"window"}};return window.navigator.mediaDevices.getUserMedia(n)}}});
