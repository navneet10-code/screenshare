!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.iframeScreenshare=r()}(this,function(){"use strict";var e=!1;function r(){return{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15}}}}var n=0;return{initializeScreenShare:function(r,n){window.chrome&&window.chrome.webstore&&(!e||n)&&(e=!0,window.addEventListener("message",function e(n){if(n&&n.data&&"getScreen"===n.data.type){var i=window.sessionStorage.getScreenMediaJSExtensionId;if(!i)try{var t=r.split("/").pop();return window.open(r,"_webstore"),void setTimeout(function(){if(window.sessionStorage.getScreenMediaJSExtensionId=t,n.data.installOnly)return n.source.postMessage(n.data,"*");e(n)},6e3)}catch(e){return n.source.postMessage({err:e},"*")}if(n.data.installOnly)return n.source.postMessage(n.data,"*");window.chrome.runtime.sendMessage(i,n.data,function(e){n.source.postMessage(e,"*")})}}))},requestScreenShare:function(e,i){if(!window.navigator||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){if(!Promise)throw new Error("requestScreenShare called in unsupported browser");return Promise.reject(new Error("Unsupported"))}if(window.chrome){if(window.chrome&&!window.chrome.runtime){if(i)return Promise.resolve();var t=e&&e.chrome||r();return window.navigator.mediaDevices.getUserMedia(t)}var o=n++;return new Promise(function(n,t){setTimeout(function(){t(new Error("Screen capture timeout"))},6500),window.addEventListener("message",function i(a){if((!a||"process-tick"!==a.data)&&a&&a.data&&a.data.id===o&&(window!==window.parent||!a||!a.data||"getScreen"!==a.data.type&&"getScreenPending"!==a.data.type)){if(window.removeEventListener("message",i),!a.data.sourceId)return a.data.err?t(a.data.err):a.data.installOnly?n(a.data):t(new Error("User Cancellation"));var d=e&&e.chrome||r();d.video.mandatory.chromeMediaSourceId=a.data.sourceId,window.navigator.mediaDevices.getUserMedia(d).then(n,t)}}),window.parent.postMessage({type:"getScreen",installOnly:i,id:o,url:window.location.origin},"*")})}if(i)return Promise.resolve();var a=e&&e.firefox||{audio:!1,video:{mediaSource:"window"}};return window.navigator.mediaDevices.getUserMedia(a)}}});
