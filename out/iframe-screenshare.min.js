!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):e.iframeScreenshare=i()}(this,function(){"use strict";var e=!1;function i(){return window.navigator.mediaDevices.getDisplayMedia?{audio:!1,video:{displaySurface:"monitor"}}:{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15}}}}var r=0;function n(e){return window.navigator.mediaDevices.getDisplayMedia?(console.log("iframeScreenshare Using getDisplayMedia"),window.navigator.mediaDevices.getDisplayMedia(e)):(console.log("iframeScreenshare Using getUserMedia"),window.navigator.mediaDevices.getUserMedia(e))}return{initializeScreenShare:function(i,r){!window.chrome||e&&!r||(e=!0,window.addEventListener("message",function e(r){if(r&&r.data&&"getScreen"===r.data.type){var n=window.sessionStorage.getScreenMediaJSExtensionId;if(!n){if(!i)return void console.error("No webstore url provided, and no extension is installed");try{var a=i.split("/").pop();return window.open(i,"_webstore"),void setTimeout(function(){if(window.sessionStorage.getScreenMediaJSExtensionId=a,r.data.installOnly)return r.data.type="gotScreen",r.source.postMessage(r.data,"*");e(r)},6e3)}catch(e){return console.error(e),r.source.postMessage({err:e.message},"*")}}if(r.data.installOnly)return r.data.type="gotScreen",r.source.postMessage(r.data,"*");window.chrome.runtime.sendMessage(n,r.data,function(e){e.id=r.data.id,r.source.postMessage(e,"*")})}}))},requestScreenShare:function(e,a){if(!window.navigator||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){if(!Promise)throw new Error("requestScreenShare called in unsupported browser");return Promise.reject(new Error("Unsupported"))}if(window.chrome){if(!window.chrome||window.chrome.runtime){if(window.navigator.mediaDevices.getDisplayMedia)return n(e&&e.chrome||i());var o=r++;return new Promise(function(r,t){var d=void 0;d=function(a){if((!a||"process-tick"!==a.data)&&a&&a.data&&a.data.id===o&&(window!==window.parent||!a||!a.data||"getScreen"!==a.data.type&&"getScreenPending"!==a.data.type)){if(window.removeEventListener("message",d),!a.data.sourceId)return a.data.err?t(a.data.err):a.data.installOnly?r(a.data):t(new Error("User Cancellation"));var s=e&&e.chrome||i();return s.video.mandatory.chromeMediaSourceId=a.data.sourceId,n(s).then(r,t)}}.bind(this),window.addEventListener("message",d),window.parent.postMessage({type:"getScreen",installOnly:a,id:o,url:window.location.origin},"*")})}return a?Promise.resolve():n(e&&e.chrome||i())}return a?Promise.resolve():n(e&&e.firefox||{audio:!1,video:{mediaSource:"window"}})}}});
