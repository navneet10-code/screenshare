!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.iframeScreenshare=r()}(this,function(){"use strict";var e=!1;function r(){return{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15}}}}var t=0;return{initializeScreenShare:function(r,t){!window.chrome||e&&!t||(e=!0,window.addEventListener("message",function e(t){if(t&&t.data&&"getScreen"===t.data.type){var n=window.sessionStorage.getScreenMediaJSExtensionId;if(!n)try{var i=r.split("/").pop();return window.open(r,"_webstore"),void setTimeout(function(){if(window.sessionStorage.getScreenMediaJSExtensionId=i,t.data.installOnly)return t.data.type="gotScreen",t.source.postMessage(t.data,"*");e(t)},6e3)}catch(e){return t.source.postMessage({err:e},"*")}if(t.data.installOnly)return t.data.type="gotScreen",t.source.postMessage(t.data,"*");window.chrome.runtime.sendMessage(n,t.data,function(e){e.id=t.data.id,t.source.postMessage(e,"*")})}}))},requestScreenShare:function(e,n){if(!window.navigator||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){if(!Promise)throw new Error("requestScreenShare called in unsupported browser");return Promise.reject(new Error("Unsupported"))}if(window.chrome){if(window.chrome&&!window.chrome.runtime){if(n)return Promise.resolve();var i=e&&e.chrome||r();return window.navigator.mediaDevices.getUserMedia(i)}var a=t++;return new Promise(function(t,i){var o=void 0;o=function(n){if((!n||"process-tick"!==n.data)&&n&&n.data&&n.data.id===a&&(window!==window.parent||!n||!n.data||"getScreen"!==n.data.type&&"getScreenPending"!==n.data.type)){if(window.removeEventListener("message",o),!n.data.sourceId)return n.data.err?i(n.data.err):n.data.installOnly?t(n.data):i(new Error("User Cancellation"));var d=e&&e.chrome||r();d.video.mandatory.chromeMediaSourceId=n.data.sourceId,window.navigator.mediaDevices.getUserMedia(d).then(t,i)}}.bind(this),setTimeout(function(){i(new Error("Screen capture timeout"))},6500),window.addEventListener("message",o),window.parent.postMessage({type:"getScreen",installOnly:n,id:a,url:window.location.origin},"*")})}if(n)return Promise.resolve();var o=e&&e.firefox||{audio:!1,video:{mediaSource:"window"}};return window.navigator.mediaDevices.getUserMedia(o)}}});
